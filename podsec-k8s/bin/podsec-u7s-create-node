#!/bin/sh

. podsec-u7s-functions

config_dir=/var/lib/u7s-admin/.config
mkdir -p $config_dir
chown u7s-admin:u7s-admin -R ~u7s-admin
chown u7s-admin:u7s-admin -R ~u7s-admin
rm -f /etc/kubernetes/*
chown -R u7s-admin:u7s-admin /etc/kubernetes /var/lib/etcd/ /run/flannel/

echo "Введите пароль пользователя u7s-admin:"
passwd u7s-admin

cd ~u7s-admin/usernetes/boot
rm -f /tmp/kubeadm.log;
su - -c 'bash -x ~u7s-admin/usernetes/boot/kubeadm.sh 2>&1' u7s-admin  | tee /tmp/kubeadm.log

mkdir -p /root/.kube/
chmod 600 /root/.kube/
cp -f /etc/kubernetes/admin.conf /root/.kube/config

mkdir -p ~u7s-admin/.kube/
chmod 700 ~u7s-admin/.kube/
cp -f /etc/kubernetes/admin.conf ~u7s-admin/.kube/config
chmod 600 ~u7s-admin/.kube/config
chown u7s-admin:u7s-admin ~u7s-admin/.kube/config
