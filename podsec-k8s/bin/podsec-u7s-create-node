#!/bin/sh

. podsec-u7s-functions

echo "Введите пароль пользователя u7s-admin:"
passwd u7s-admin

systemctl enable --now u7s

mkdir -p /root/.kube/
chmod 600 /root/.kube/
cp ~u7s-admin/.config/usernetes/master/admin-localhost.kubeconfig /root/.kube/config

mkdir -p ~u7s-admin/.kube/
chmod 700 ~u7s-admin/.kube/
cp ~u7s-admin/.config/usernetes/master/admin-localhost.kubeconfig ~u7s-admin/.kube/config
chmod 600 ~u7s-admin/.kube/config
chown -R u7s-admin:u7s-admin ~u7s-admin/.kube/

sleep 1
until kubectl apply -f ~u7s-admin/usernetes/manifests/coredns.yaml >/dev/null 2>&1
do
  sleep 3
done


